## Mediainfo Project New Generation (MP NG) 提示信息介绍及对应处理方法

### 配置及使用步骤

1. 从 [GitHub](https://github.com/vcb-s/MediainfoProjectNg/releases) 或 [r31](https://r31.3333.moe) 下载最新版并解压.
2. 安装 [Mediainfo](https://mediaarea.net/en/MediaInfo), 并将 Mediainfo 安装目录下的 `Mediainfo.dll` 复制到上一步的文件夹中.
    - MP NG 支持 `0.7.94` 版本及后续版本的 Mediainfo. `0.7.85` 版本下亦可运行, 但会出现某些信息缺失.
    - 建议直接使用当前最新版本的 Mediainfo.
3. 打开 MP NG, 将文件夹或单个文件拖动到程序界面上即可开始加载. 如果分多次加载, 那么之前加载的内容不会被清空, 新加载的内容会排列到之前内容的后面. 使用右上角的 `clear` 按钮清空已加载的文件.
4. 单击左侧列表中的某一行, 会在右侧的文本框中显示 Mediainfo 的纯文本输出结果, 便于深入检查文件细节.
5. 双击左侧列表中的某一行, 会弹出小窗口显示改文件的详细信息. 上半部分显示文件的错误信息, 下半部分显示 Mediainfo 的树状形式输出结果.

### 常见提示信息及错误信息颜色对照表

| 颜色                                                         | 信息                                              |
| ------------------------------------------------------------ | ------------------------------------------------- |
| ![](https://place-hold.it/15/ff0000/000000?text=+) 红色       | 文件后缀与容器不符                                |
| ![](https://place-hold.it/15/00a4ac/000000?text=+) 品葱色     | 容器中含有延时非 0 的轨道                         |
| ![](https://place-hold.it/15/DB7093/000000?text=+) 浅紫红色   | 轨道间长度相差过大                                |
| ![](https://place-hold.it/15/ffff00/000000?text=+) 黄色       | 章节问题                                          |
| ![](https://place-hold.it/15/EE82EE/000000?text=+) 粉紫色     | 内容物与文件名描述不符                            |
| ![](https://place-hold.it/15/ADFF2F/000000?text=+) 亮绿色     | 文件含有多条音轨                                  |
| ![](https://place-hold.it/15/0000ff/000000?text=+) 蓝色文字   | 文件含有字幕                                      |
| ![](https://place-hold.it/15/9400D3/000000?text=+) 深紫色文字 | VFR                                             |
| ![](https://place-hold.it/15/808000/000000?text=+) 橄榄色文字 | 帧率为 29.970 (30000/1001) 或 59.940 (60000/1001) |
| ![](https://place-hold.it/15/6A5ACD/000000?text=+) 岩蓝色文字 | 帧率分母非 1001                                   |
| ![](https://place-hold.it/15/800000/000000?text=+) 栗色文字   | 其他特殊帧率                                      |

### 颜色详解及对应处理方法: 错误信息

这一部分介绍 MP NG 中会出现的报错, 这些报错往往意味着整理成品中可能存在压制错误、命名错误或其他整理错误, 往往需要手动修复.

**1. ![](https://place-hold.it/10/ff0000/000000?text=+) 红色: 文件后缀与容器不符**

- MP NG 会检查容器格式与对应后缀的关系, 目前会检查 Matroska 和 MPEG-4 两种容器. 对应的后缀名如下:
  - Matroska: .mkv, .mka, .mks
  - MPEG-4: .mp4, .m4a, .m4s

- 解决方法
    1. 查看 MP NG `容器`一栏的信息, 确定文件是 Matroska 或 MPEG-4 封装.
    2. 确定出错文件内包含的轨道, 并修改为对应的后缀名. 若文件内包含视频请使用视频后缀 (.mkv, .mp4), 若不包含视频请使用音频后缀 (.mka).

**2. ![](https://place-hold.it/10/00a4ac/000000?text=+) 品葱色: 容器中含有延时非 0 的轨道**

- 封装或编码过程中会带来视频轨道或音频轨道的延时. 常见的问题如下:
  - aac 20ms delay 问题. 由于使用了特定的 `qaac` 编码参数导致 aac 格式音轨产生 20ms 的无用延时.
  - 轨道对齐延时. 由于压制过程中使用了不同来源的视频和音频, 为了使二者同步播放所人为添加的延时.

- 解决方法
  - aac 20ms delay 问题:
      1. 下载对照组 (如 jsum) 并使用 `gMKVExtractGUI` 抽取对应音轨, 或下载原盘并使用 `eac3to` 抽取对应音轨.
      2. 在 `foobar2000` 中使用 `qaac` 及参数 `-i -s -q 2 -v 192 --no-delay -o %d -` 进行重编码.
      3. 使用 `MKVToolNixGUI` 将原延时音轨替换成重编码处理过的音轨, 进行重封装处理.

  - 轨道对齐延时 (本操作非必须), 若存在延时的轨道是音轨, 即音轨**晚于**视频轨开始播放, 则需给音轨添加前黑:
      1. 抽取延时音轨并解码成无压缩格式. 
      2. 使用 `Audition` 或其他音频处理软件, 在音轨的开头添加**延时对应时长**的空白音频片段.
      3. 使用相应格式的编码器 (flac 或 qaac) 将音轨编码成压缩格式.
      4. 使用 `MKVToolNixGUI` 将原延时音轨替换成重编码处理过的音轨, 进行重封装处理.

  - 轨道对齐延时 (本操作非必须), 若存在延时的轨道是视频轨, 即音轨**早于**视频轨开始播放, 则需对音轨进行切割, 详细操作见下一节.

**3. ![](https://place-hold.it/10/DB7093/000000?text=+) 浅紫红色: 轨道间长度相差过大**

- 当视频轨与音轨长度相差过大 (超过 1 秒) 时, MP NG 会提示轨道长度相差过大. 常见的问题如下:
  - 压制过程中出现的切割错误, 如错误的切割和拼接视频.
  - 原盘本身章节信息不准确, 导致音频或视频存在前黑或后黑片段.

- 解决方法: 需要先判断是否为压制错误, 如果依据手动播放检查或对照组检查后发现是压制错误, 则在整理组群内汇报并同时向压制组员及总监汇报. 其余问题解决方法如下:
  - 视频长度超过音轨: 向总监汇报询问是否需要切掉.
  - 视频长度短于音轨: 使用 `TrimAudio.py` 和对照组自动切除多余部分.

**4. ![](https://place-hold.it/10/ffff00/000000?text=+) 黄色: 章节问题**

- 章节问题包括一下四种子问题:
  - 文件只有一个章节
  - 文件存在多组章节
  - 文件末尾有无用章节
  - 首个章节时间戳非零

- 解决方法
  - 使用 `MKVToolNixGUI` 的章节编辑器进行编辑并保存.

**5. ![](https://place-hold.it/10/EE82EE/000000?text=+) 粉紫色: 内容与文件名描述不符**

- MP NG 会检查视频编码 Profile、视频编码格式、音频编码格式并与文件名中类似于 `[Ma10p_1080p][x265_flac]` 的部分进行比较, 并判断是否出现命名错误. 常见错误如下:
  - Profile 错误
  - 视频编码格式错误
  - 音频编码格式错误

- 解决方法
  - Profile 错误: 需参考左下窗口 `Mediainfo` 纯文本输出信息中视频轨道对应的位深等信息, 目前会出现的格式是 `Ma10p`/`Hi10p`/`Hi444pp` 三种, 详细使用情况参考整理组成品规范.
  - 视频编码格式错误: 目前使用的视频编码是 `HEVC`/`AVC` 两种, 分别对应命名中的 `x265`/`x264`.
  - 音频编码格式错误: 目前使用的音频编码是 `FLAC`/`AAC`/`AC3` 三种, 命名时如出现多音轨和多格式音轨的情况, 请使用数字和下划线进行命名, 例如 `x265_flac_2aac_3ac3` 表示该文件中包含 1 个 `HEVC` 编码的视频轨、1 个 `FLAC` 编码的音轨、2 个 `AAC` 编码的音轨和 3 个 `AC3` 编码的音轨.

### 颜色详解及对应处理方法: 提示信息

这一部分介绍 MP NG 中会出现的提示信息, 这些提示不代表整理成品存在错误, 但有可能存在需要予以特殊"关照"的成品文件.

**1. ![](https://place-hold.it/10/ADFF2F/000000?text=+) 亮绿色: 文件含有多条音轨**

- 单个文件中存在大于等于 3 条音轨. 有可能是该番剧存在复数条评论音轨 (如声优评论音轨、监督评论音轨、其他主创评论音轨), 也有可能是错误的封入了多余音轨. 与对照组进行比较得出结论.

**2. ![](https://place-hold.it/10/0000ff/000000?text=+) 蓝色文字: 文件含有字幕**

- 文件中存在内封的 PGS 或其他类型的字幕轨道. 需要注意的是:
  - 原盘中带有的图形字幕**需要**全部封入对应压制成品文件中, 如果没有则需要手动提取对照组或原盘中的字幕轨道并重封. 此外, 需要封入 mkv 文件还是 mka 文件, 请参考整理组成品规范.
  - 字幕组提供的 ass 格式的外挂字幕文件**不需要**封入压制成品.

**3. 其他颜色文字: 特殊帧率**

- MP NG 还能检查压制成品的帧率, 一些特殊帧率 (区别于常见帧率**24000/1001≈23.976 fps**) 会高亮显示.
  - ![](https://place-hold.it/10/9400D3/000000?text=+) **深紫色**: VFR (variable frame rate), 即可变帧率, 常见于真人视频与非真人视频间杂的视频, 注意此类视频往往无法进行 RPC 检查, 为防止出错请尽量人工检查.
  - ![](https://place-hold.it/10/808000/000000?text=+) **橄榄色**: 帧率为 **30000/1001≈29.970 fps** 或 **60000/1001≈59.940 fps**, 常见于进行过反交错/IVTC后的视频及各种真人视频.
  - ![](https://place-hold.it/10/6A5ACD/000000?text=+) **岩蓝色**: 帧率分母为 1000, 如**23976/1000** 或 **29970/1000**, 这类问题是可能是由于 hevc 流、mkv 文件头或 Mediainfo 显示错误导致, 但目前尚无定论, 亦无严重影响. 原则上可以不处理, 也可自行联系总监决定是否修复.
  - ![](https://place-hold.it/10/800000/000000?text=+) **栗色**: 其他特殊帧率, 包括但不限于以下几种:
    - **1 fps**: 常见于有 BGM 的静态菜单.
    - **25 fps**: PAL 制式视频源的压制成品, 目前非常少见. 可参考 西游记 和 舌尖上的中国.
    - **24 fps**: 常见于同人作品与非日本地区制作的动漫中, 可参考 RWBY. 亦有可能是压制脚本错误导致的错误帧率, 请与对照组或原盘比较得出结论.
