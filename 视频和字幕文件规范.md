# 视频和字幕文件规范

> 本规范是制作规范的拓展说明, 用于各环节制作人员参阅  
> 关于成品规格更专门的说明, 应另外参阅《制作规格》(虽然已经年久失修)

‍

## 视频

* 内容

  逐帧画面内容一致, 时长相等, 总帧数正确

  应尽力确保排除非人为的预处理出错和重编码出错导致如花屏漏帧之类的错误
* 帧率

  采用逐行扫描 (Progressive)  
  原盘为隔行扫描的, 一般都应进行反交错处理并确保得到正确的画面和帧率

  确认视频的帧率模式和帧率数值正确  
  基本都是 CFR (Constant Frame Rate 固定帧率)  
  最常见的 CFR FPS 有 23.976 (24000/1001), 29.970 (30000/1001), 59.940 (60000/1001)  
  *当视频短于 30 秒且 MPNG 检测到 23.976 (23976/1000) 等分母为 1000 的帧率时，为检测 BUG 也视为正确
* 分辨率

  除移动版外分辨率通常与源 BD/DVD 相同, 但可能存在如下情况：

  黑边切割：常见于剧场版  
  降采样：片源有效分辨率整体低于 1080p 所以降采样来节省码率  
  升采样：常见于 480p/576p 的 DVD 片源做成 720p
* 信息标注

  保留有完整的编码参数信息, 色彩矩阵参数 (BT.601/709/2020) 等

  视频轨道不含有语言标注 (即 und)
* 封装格式和视频编码

  |类型|封装格式 (视频编码)|
  | ------------------------| --------------------------------------------------------|
  |标准版 动态视频|MKV (HEVC Main 10 \| Ma 444 10p)<br />MKV (AVC High 10)|
  |标准版 静态视频 有 BGM|MKV (AVC Hi444pp \| HEVC Main 10) \| PNG+FLAC|
  |标准版 静态视频 无 BGM|PNG|
  |移动版 动态视频|MKV/MP4 (HEVC Main \| HEVC Main 10 \| AVC High)|

  注意文件拓展名应该与文件实际封装格式一致

‍

## 音频

* 音画内容相符
* 音画时间同步 (尤其注意排除转码 AAC 可能导致的偏移)
* 音画时长一致 (一般是一致的, 但确实存在不等的情况)
* 数量齐全 (但不包含重复/冗余/置空等音轨)
* 声道数/位深/采样率保持原样 (一般是原样, 存在例外)
* 需要有正确的音轨语言标注
* 无编码错误
* 并按以下转码规则/保留规则/封装规则进行了处理:

  |源音轨分类|成品编码|封装位置|
  | ---------------------------------| ------------------| -------------------------------|
  |**标准版正片 ** 主音轨 无损 2.0CH|FLAC|内封 MKV|
  |**标准版正片 ** 主音轨 无损 >2.0CH|FLAC|外挂 MKA *另见(a)|
  |**标准版正片 ** 主音轨 有损||丢弃 *另见(b)|
  |**标准版正片 ** 主音轨 特殊|具体讨论 *见(c)|外挂 MKA *另见(a)|
  |**标准版正片 ** 评论轨 无损 2.0/2.1CH|AAC CVBR 192kbps|内封 MKV（如已有 MKA 则外挂）|
  |**标准版正片 ** 评论轨 无损 5.1/7.1CH|AAC CVBR 320kbps|内封 MKV（如已有 MKA 则外挂）|
  |**标准版正片 ** 评论轨 有损 <512kbps|保持原样|内封 MKV（如已有 MKA 则外挂）|
  |**标准版正片 ** 评论轨 有损 >=512kbps 2.0/2.1CH|AAC CVBR 192kbps|内封 MKV（如已有 MKA 则外挂）|
  |**标准版正片 ** 评论轨 有损 >=512kbps 5.1/7.1CH|AAC CVBR 320kbps|内封 MKV（如已有 MKA 则外挂）|
  |**标准版特典 ** 动画 无损|FLAC|内封|
  |**标准版特典 ** 非动画 无损 2.0/2.1CH|AAC CVBR 192kbps|内封 MKV|
  |**标准版特典 ** 非动画 无损 5.1/7.1CH|AAC CVBR 320kbps|内封 MKV|
  |**标准版特典 ** 非动画 有损 <512kbps|保持原样|内封 MKV|
  |**标准版特典 ** 非动画 有损 >=512kbps 2.0/2.1CH|AAC CVBR 192kbps|内封 MKV|
  |**标准版特典 ** 非动画 有损 >=512kbps 5.1/7.1CH|AAC CVBR 320kbps|内封 MKV|
  |**移动版 ** 主音轨 2.0CH *另见(d)|AAC CVBR 192kbps|内封 MP4|
  |**移动版 ** 其它||丢弃|

  (a) 同一视频的所有外挂音轨均封装在同一个 MKA 文件里，注意保持一致的轨道顺序  
  (b) 片源只有有损主音轨或 >2.0CH 无损主音轨的时候同样内封  
  (c) 特殊音轨：DTS Headphone X 转 FLAC，视障音轨规格按主音轨处理  
  (d) 对于部分特殊 MKV 移动版本/先行版本，具体情况具体讨论

‍

## 章节

* 片源提供且时间点有意义的章节文件均应保留 (如正片和长特典)

  存在多段分开内容的视频必须带有章节 (如 CM/PV Collection)
* 章节均内封于对应的视频文件 (MKV/MP4)
* 章节的时间点均应正确

  典型的时间点位于画面切换后的首帧

  原盘时间点可以罕见地出错, 以实际视频画面需要的时间点为准
* 章节的数量应当正确

  注意确认视频开头时间点的存在  
  注意移除视频结尾的冗余时间点
* 章节的内容文本为有意义的文字

  默认为 `Chapter XX`​​ / `Chapter [0-9]{2}`​​ 从 01 开始连续编号

  也可以使用表达具体内容的章节时间内容, 最常见于演唱会  
  文本不要求还原 BD 菜单, 如要采用这样的章节文本请确保输入正确  
  如使用了任何非 ASCII 字符，应在封装时为其选择合适的字符集

  对于 Matroska 封装格式会需要标注章节文件的语言  
  默认章节文本即为 `en`​​  
  自定义章节文本则根据实际内容选择正确的语言如 `ja`​​ `zh`​​

‍

## 字幕

* 片源图形字幕 (PGS) 如有则内封于对应标准版视频文件中 (MKV), 移动版视频不带 (MP4 也带不了)

  *有时总监可能为原盘菜单特典还原原生画面, 导致至多存在上百条 PGS 字幕, 有没有都属于正常且正确的情况
* 合作组外挂字幕

  对于标准版则采用外挂 ASS 文件  
  对于移动版则采用画面硬嵌

  应确保字幕文件播放正常  
  原则上尽量避免采用需要额外高级字幕渲染器如 VSFilterMod 才能正确显示的特效字幕

  检查字幕内容存在的问题本质上不属于我们的工作范围  
  但如果发现明显的翻译/时轴/缺漏或其它问题, 鼓励报告给字幕组后进行修正

  如果字幕中的鸣谢部分存在"压制"职位, 应最好修改为 "VCB-Studio"  
  如果字幕文件中存在 "Aegisub Garbage" 等冗余部分, 应最好删除

  使用 ASS 外挂字幕时应配附有字体包  
  字体包应带且仅带有 ASS 字幕中所包含的所有字体  
  所有字体应打包为 7Z 或 ZIP 压缩包后附带在成品中  
  字体打包时直接对所有字体文件打包, 不要含有目录
  如字体文件名存在非 ASCII 字符, 应避免使用 WinRAR 默认压缩, 采用 7Z 打包或压缩时指定 UTF-8 文件名

‍
